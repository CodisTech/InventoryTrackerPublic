Fix role switching functionality and improve type safety in multi-item checkout modal
